"use client";

import { useState } from "react";

type Props = {
  variantId?: string;
};

export default function ProductActions({ variantId }: Props) {
  const [qty, setQty] = useState(1);
  const [isAdding, setIsAdding] = useState(false);

  const handleQtyChange = (nextValue: number) => {
    if (Number.isNaN(nextValue)) return;
    const safeValue = Math.min(Math.max(nextValue, 1), 99);
    setQty(safeValue);
  };

  const handleAddToCart = async () => {
    if (!variantId || isAdding) return;
    setIsAdding(true);
    try {
      const response = await fetch("/api/cart/add", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ variant_id: variantId, qty }),
      });
      if (response.status === 401) {
        window.location.href = "/login";
      }
    } finally {
      setIsAdding(false);
    }
  };

  return (
    <div className="mt-4 flex flex-col gap-4">
      <div className="flex items-center justify-between gap-3">
        <span className="text-sm font-medium text-[#666666]">عدد الكمية</span>
        <div className="flex items-center gap-2 border border-[#EEEEEE] rounded-sm px-2 py-1 bg-white">
          <button
            type="button"
            className="h-8 w-8 rounded-sm text-[#666666] hover:bg-[#F8F8F8]"
            onClick={() => handleQtyChange(qty - 1)}
            disabled={qty <= 1}
          >
            -
          </button>
          <input
            type="number"
            min={1}
            max={99}
            value={qty}
            onChange={(event) => handleQtyChange(Number(event.target.value))}
            className="w-12 text-center text-sm text-[#333333] focus:outline-none"
          />
          <button
            type="button"
            className="h-8 w-8 rounded-sm text-[#666666] hover:bg-[#F8F8F8]"
            onClick={() => handleQtyChange(qty + 1)}
          >
            +
          </button>
        </div>
      </div>

      <div className="flex flex-row-reverse gap-2">
        <button
          type="button"
          onClick={handleAddToCart}
          disabled={!variantId || isAdding}
          className={`flex-1 h-11 border border-[#B47720] text-[#B47720] flex justify-center items-center gap-1 rounded-sm text-sm font-semibold transition hover:bg-[#B47720] hover:text-white ${
            isAdding ? "opacity-70 cursor-not-allowed" : ""
          }`}
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M3.54229 4.56419C3.53235 4.45417 3.54543 4.34329 3.58071 4.23861C3.61599 4.13393 3.67269 4.03774 3.74719 3.95619C3.82169 3.87463 3.91237 3.80948 4.01344 3.76491C4.11451 3.72033 4.22376 3.69729 4.33422 3.69727H13.976C14.0951 3.69732 14.2127 3.72411 14.32 3.77566C14.4274 3.82722 14.5218 3.90222 14.5962 3.99514C14.6707 4.08805 14.7234 4.19651 14.7504 4.3125C14.7773 4.4285 14.7779 4.54906 14.7521 4.66531L13.9374 8.33751C13.7972 8.96858 13.446 9.53296 12.9418 9.93745C12.4375 10.3419 11.8104 10.5623 11.1639 10.5622H6.67934C5.97022 10.5622 5.28673 10.297 4.76321 9.81872C4.2397 9.34041 3.91402 8.68358 3.8502 7.97733L3.54229 4.56419ZM4.7069 4.83347L4.98186 7.87508C5.02017 8.29902 5.21573 8.69328 5.53008 8.98029C5.84443 9.26731 6.25481 9.4263 6.68048 9.42599H11.1651C11.5528 9.4259 11.929 9.29356 12.2314 9.05084C12.5338 8.80812 12.7444 8.46952 12.8285 8.09096L13.5522 4.83347H4.7069Z"
              fill="#B47720"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M1.19263 1.79076C1.19263 1.64009 1.25248 1.49559 1.35902 1.38905C1.46556 1.28251 1.61006 1.22266 1.76073 1.22266H3.75362C3.89259 1.2228 4.02668 1.27387 4.13053 1.3662C4.23438 1.45853 4.30078 1.58573 4.31718 1.72372L4.77393 5.58794C4.79156 5.73771 4.74897 5.88834 4.65554 6.00671C4.5621 6.12507 4.42547 6.20147 4.27571 6.2191C4.12594 6.23673 3.97531 6.19414 3.85694 6.10071C3.73858 6.00727 3.66218 5.87064 3.64455 5.72088L3.24801 2.35772H1.76073C1.61006 2.35772 1.46556 2.29787 1.35902 2.19133C1.25248 2.08479 1.19263 1.94143 1.19263 1.79076ZM6.30553 13.5311C6.4562 13.5311 6.6007 13.4713 6.70724 13.3647C6.81378 13.2582 6.87363 13.1137 6.87363 12.963C6.87363 12.8124 6.81378 12.6679 6.70724 12.5613C6.6007 12.4548 6.4562 12.3949 6.30553 12.3949C6.15486 12.3949 6.01036 12.4548 5.90382 12.5613C5.79728 12.6679 5.73743 12.8124 5.73743 12.963C5.73743 13.1137 5.79728 13.2582 5.90382 13.3647C6.01036 13.4713 6.15486 13.5311 6.30553 13.5311ZM6.30553 14.6673C6.52934 14.6673 6.75096 14.6232 6.95774 14.5376C7.16452 14.4519 7.3524 14.3264 7.51065 14.1681C7.66891 14.0099 7.79445 13.822 7.8801 13.6152C7.96575 13.4085 8.00983 13.1868 8.00983 12.963C8.00983 12.7392 7.96575 12.5176 7.8801 12.3108C7.79445 12.104 7.66891 11.9162 7.51065 11.7579C7.3524 11.5996 7.16452 11.4741 6.95774 11.3885C6.75096 11.3028 6.52934 11.2587 6.30553 11.2587C5.85352 11.2587 5.42003 11.4383 5.10041 11.7579C4.78079 12.0775 4.60123 12.511 4.60123 12.963C4.60123 13.415 4.78079 13.8485 5.10041 14.1681C5.42003 14.4878 5.85352 14.6673 6.30553 14.6673ZM11.4889 13.5311C11.6396 13.5311 11.784 13.4713 11.8906 13.3647C11.9971 13.2582 12.057 13.1137 12.057 12.963C12.057 12.8124 11.9971 12.6679 11.8906 12.5613C11.784 12.4548 11.6396 12.3949 11.4889 12.3949C11.3382 12.3949 11.1937 12.4548 11.0872 12.5613C10.9806 12.6679 10.9208 12.8124 10.9208 12.963C10.9208 13.1137 10.9806 13.2582 11.0872 13.3647C11.1937 13.4713 11.3382 13.5311 11.4889 13.5311ZM11.4889 14.6673C11.7127 14.6673 11.9343 14.6232 12.1411 14.5376C12.3479 14.4519 12.5357 14.3264 12.694 14.1681C12.8523 14.0099 12.9778 13.822 13.0635 13.6152C13.1491 13.4085 13.1932 13.1868 13.1932 12.963C13.1932 12.7392 13.1491 12.5176 13.0635 12.3108C12.9778 12.104 12.8523 11.9162 12.694 11.7579C12.5357 11.5996 12.3479 11.4741 12.1411 11.3885C11.9343 11.3028 11.7127 11.2587 11.4889 11.2587C11.0369 11.2587 10.6034 11.4383 10.2838 11.7579C9.96414 12.0775 9.78458 12.511 9.78458 12.963C9.78458 13.415 9.96414 13.8485 10.2838 14.1681C10.6034 14.4878 11.0369 14.6673 11.4889 14.6673Z"
              fill="#B47720"
            />
          </svg>
          <p>أضف للسلة</p>
        </button>
        <button
          type="button"
          onClick={handleAddToCart}
          disabled={!variantId || isAdding}
          className={`flex-1 h-11 bg-[#B47720] flex justify-center items-center gap-1 text-white rounded-sm text-sm font-semibold transition hover:opacity-90 ${
            isAdding ? "opacity-70 cursor-not-allowed" : ""
          }`}
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M3.54229 4.56419C3.53235 4.45417 3.54543 4.34329 3.58071 4.23861C3.61599 4.13393 3.67269 4.03774 3.74719 3.95619C3.82169 3.87463 3.91237 3.80948 4.01344 3.76491C4.11451 3.72033 4.22376 3.69729 4.33422 3.69727H13.976C14.0951 3.69732 14.2127 3.72411 14.32 3.77566C14.4274 3.82722 14.5218 3.90222 14.5962 3.99514C14.6707 4.08805 14.7234 4.19651 14.7504 4.3125C14.7773 4.4285 14.7779 4.54906 14.7521 4.66531L13.9374 8.33751C13.7972 8.96858 13.446 9.53296 12.9418 9.93745C12.4375 10.3419 11.8104 10.5623 11.1639 10.5622H6.67934C5.97022 10.5622 5.28673 10.297 4.76321 9.81872C4.2397 9.34041 3.91402 8.68358 3.8502 7.97733L3.54229 4.56419ZM4.7069 4.83347L4.98186 7.87508C5.02017 8.29902 5.21573 8.69328 5.53008 8.98029C5.84443 9.26731 6.25481 9.4263 6.68048 9.42599H11.1651C11.5528 9.4259 11.929 9.29356 12.2314 9.05084C12.5338 8.80812 12.7444 8.46952 12.8285 8.09096L13.5522 4.83347H4.7069Z"
              fill="white"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M1.19263 1.79076C1.19263 1.64009 1.25248 1.49559 1.35902 1.38905C1.46556 1.28251 1.61006 1.22266 1.76073 1.22266H3.75362C3.89259 1.2228 4.02668 1.27387 4.13053 1.3662C4.23438 1.45853 4.30078 1.58573 4.31718 1.72372L4.77393 5.58794C4.79156 5.73771 4.74897 5.88834 4.65554 6.00671C4.5621 6.12507 4.42547 6.20147 4.27571 6.2191C4.12594 6.23673 3.97531 6.19414 3.85694 6.10071C3.73858 6.00727 3.66218 5.87064 3.64455 5.72088L3.24801 2.35772H1.76073C1.61006 2.35772 1.46556 2.29787 1.35902 2.19133C1.25248 2.08479 1.19263 1.94143 1.19263 1.79076ZM6.30553 13.5311C6.4562 13.5311 6.6007 13.4713 6.70724 13.3647C6.81378 13.2582 6.87363 13.1137 6.87363 12.963C6.87363 12.8124 6.81378 12.6679 6.70724 12.5613C6.6007 12.4548 6.4562 12.3949 6.30553 12.3949C6.15486 12.3949 6.01036 12.4548 5.90382 12.5613C5.79728 12.6679 5.73743 12.8124 5.73743 12.963C5.73743 13.1137 5.79728 13.2582 5.90382 13.3647C6.01036 13.4713 6.15486 13.5311 6.30553 13.5311ZM6.30553 14.6673C6.52934 14.6673 6.75096 14.6232 6.95774 14.5376C7.16452 14.4519 7.3524 14.3264 7.51065 14.1681C7.66891 14.0099 7.79445 13.822 7.8801 13.6152C7.96575 13.4085 8.00983 13.1868 8.00983 12.963C8.00983 12.7392 7.96575 12.5176 7.8801 12.3108C7.79445 12.104 7.66891 11.9162 7.51065 11.7579C7.3524 11.5996 7.16452 11.4741 6.95774 11.3885C6.75096 11.3028 6.52934 11.2587 6.30553 11.2587C5.85352 11.2587 5.42003 11.4383 5.10041 11.7579C4.78079 12.0775 4.60123 12.511 4.60123 12.963C4.60123 13.415 4.78079 13.8485 5.10041 14.1681C5.42003 14.4878 5.85352 14.6673 6.30553 14.6673ZM11.4889 13.5311C11.6396 13.5311 11.784 13.4713 11.8906 13.3647C11.9971 13.2582 12.057 13.1137 12.057 12.963C12.057 12.8124 11.9971 12.6679 11.8906 12.5613C11.784 12.4548 11.6396 12.3949 11.4889 12.3949C11.3382 12.3949 11.1937 12.4548 11.0872 12.5613C10.9806 12.6679 10.9208 12.8124 10.9208 12.963C10.9208 13.1137 10.9806 13.2582 11.0872 13.3647C11.1937 13.4713 11.3382 13.5311 11.4889 13.5311ZM11.4889 14.6673C11.7127 14.6673 11.9343 14.6232 12.1411 14.5376C12.3479 14.4519 12.5357 14.3264 12.694 14.1681C12.8523 14.0099 12.9778 13.822 13.0635 13.6152C13.1491 13.4085 13.1932 13.1868 13.1932 12.963C13.1932 12.7392 13.1491 12.5176 13.0635 12.3108C12.9778 12.104 12.8523 11.9162 12.694 11.7579C12.5357 11.5996 12.3479 11.4741 12.1411 11.3885C11.9343 11.3028 11.7127 11.2587 11.4889 11.2587C11.0369 11.2587 10.6034 11.4383 10.2838 11.7579C9.96414 12.0775 9.78458 12.511 9.78458 12.963C9.78458 13.415 9.96414 13.8485 10.2838 14.1681C10.6034 14.4878 11.0369 14.6673 11.4889 14.6673Z"
              fill="white"
            />
          </svg>
          <p>الشراء السريع</p>
        </button>
      </div>
    </div>
  );
}
